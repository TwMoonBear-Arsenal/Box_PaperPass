# 此 GitHub Actions 工作流程的功能為將指定檔案複製到工作資料夾，並將這些檔案打包成 ZIP 檔，然後上傳至新的預發佈。
# 使用說明: 
# 1.將本檔案另存成 .github/workflows/Package.yml 置於您的專案根目錄。
# 2.當推送至 main 分支後，此工作流程將自動執行。

name: 1.Package

on:
  push:
    branches:
      - main

jobs:
  Build_and_Package:
    runs-on: ubuntu-latest
    steps:
      - name: 檢出代碼
        uses: actions/checkout@v2

      - name: 建立打包目錄
        run: mkdir -p package

      - name: 複製檔案到打包目錄
        run: |
          cp source/Scr_SimpleDemoBox/SimpleDemoBox.sh package/SimpleDemoBox.sh
          cp source/Cfg_Docker/dockerfile package/dockerfile
          cp README.md package/README.md

      - name: 打包檔案
        run: zip -r package.zip package/
    outputs:
      package: ${{ steps.Build_and_Package.outputs.package }}
      upload_url: ${{ github.event.release.upload_url }}

  PreRelease:
    runs-on: ubuntu-latest
    needs: Build_and_Package
    steps:
      - name: 上傳至預發佈資源
        uses: actions/upload-release-asset@v1
        with:
          upload_url: ${{ needs.Build_and_Package.outputs.upload_url }}
          asset_path: ./package.zip
          asset_name: package.zip
          asset_content_type: application/zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
